
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="index, follow" />

  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet/less" type="text/css" href="https://theodox.github.io/theme/stylesheet/style.less">
    <script src="//cdnjs.cloudflare.com/ajax/libs/less.js/2.5.1/less.min.js" type="text/javascript"></script>

  <link rel="stylesheet" type="text/css" href="https://theodox.github.io/theme/pygments/monokai.min.css">
  <link rel="stylesheet" type="text/css" href="https://theodox.github.io/theme/font-awesome/css/font-awesome.min.css">


    <link href="https://theodox.github.io/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Chimeras & Manticores Atom">

    <link href="https://theodox.github.io/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="Chimeras & Manticores RSS">


<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-79232212-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

<meta name="author" content="Steve Theodore" />
<meta name="description" content="It used to be impossible to launch any old Maya Python script directly from the desktop. But not anymore, thanks to this one simple trick!" />
<meta name="keywords" content="python, maya, programming, distribution, MEL">

<meta property="og:site_name" content="Chimeras & Manticores"/>
<meta property="og:title" content="Pythonception!"/>
<meta property="og:description" content="It used to be impossible to launch any old Maya Python script directly from the desktop. But not anymore, thanks to this one simple trick!"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://theodox.github.io/2018/pythonception"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2018-11-15 00:00:00-08:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://theodox.github.io/author/steve-theodore.html">
<meta property="article:section" content="blog"/>
<meta property="article:tag" content="python"/>
<meta property="article:tag" content="maya"/>
<meta property="article:tag" content="programming"/>
<meta property="article:tag" content="distribution"/>
<meta property="article:tag" content="MEL"/>
<meta property="og:image" content="">

   <title>Chimeras & Manticores &ndash; Pythonception!</title>


    <link rel="canonical" href="https://theodox.github.io/2018/pythonception"/>

  <script type="text/javascript">
    var host = "https://theodox.github.io";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
      window.location.protocol = "https";
  </script>

</head>
<body>



  <aside>
    <div>
      <h2>Chimeras & Manticores</h2>
      <a href="https://theodox.github.io">
        <img src="https://theodox.github.io/theme/img/profile.png" alt="" title="">
      </a>
      <h1><a href="https://theodox.github.io"></a></h1>

<p>a blog about technical art, python, the games business, and obscurantism</p>


      <ul class="social">
        <li><a class="sc-linkedin" href="https://www.linkedin.com/in/stevetheodore" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-github" href="https://github.com/theodox" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-google" href="https://plus.google.com/u/0/+SteveTheodore480BC/posts" target="_blank"><i class="fa fa-google"></i></a></li>
        <li><a class="sc-stack-overflow" href="http://stackoverflow.com/users/1936075/theodox" target="_blank"><i class="fa fa-stack-overflow"></i></a></li>
      </ul>

    <nav>
<!---if pages or LINKS -->


        <div>
          <h3 class="tagcloud_header">SUBJECTS</h3>
        </div>
        <ul class="tagcloud">
            <li class="tag-3">
                <a href="https://theodox.github.io/tag/mel.html">
                MEL
                        <span class="badge">(2)</span>
                </a>
            </li>
            <li class="tag-3">
                <a href="https://theodox.github.io/tag/animation.html">
                animation
                        <span class="badge">(3)</span>
                </a>
            </li>
            <li class="tag-3">
                <a href="https://theodox.github.io/tag/api.html">
                api
                        <span class="badge">(3)</span>
                </a>
            </li>
            <li class="tag-3">
                <a href="https://theodox.github.io/tag/articles.html">
                articles
                        <span class="badge">(2)</span>
                </a>
            </li>
            <li class="tag-3">
                <a href="https://theodox.github.io/tag/blog.html">
                blog
                        <span class="badge">(3)</span>
                </a>
            </li>
            <li class="tag-2">
                <a href="https://theodox.github.io/tag/blogging.html">
                blogging
                        <span class="badge">(4)</span>
                </a>
            </li>
            <li class="tag-3">
                <a href="https://theodox.github.io/tag/boo.html">
                boo
                        <span class="badge">(3)</span>
                </a>
            </li>
            <li class="tag-2">
                <a href="https://theodox.github.io/tag/books.html">
                books
                        <span class="badge">(4)</span>
                </a>
            </li>
            <li class="tag-2">
                <a href="https://theodox.github.io/tag/bugs.html">
                bugs
                        <span class="badge">(5)</span>
                </a>
            </li>
            <li class="tag-2">
                <a href="https://theodox.github.io/tag/cg.html">
                cg
                        <span class="badge">(8)</span>
                </a>
            </li>
            <li class="tag-2">
                <a href="https://theodox.github.io/tag/distribution.html">
                distribution
                        <span class="badge">(5)</span>
                </a>
            </li>
            <li class="tag-2">
                <a href="https://theodox.github.io/tag/games.html">
                games
                        <span class="badge">(10)</span>
                </a>
            </li>
            <li class="tag-2">
                <a href="https://theodox.github.io/tag/gdc.html">
                gdc
                        <span class="badge">(12)</span>
                </a>
            </li>
            <li class="tag-3">
                <a href="https://theodox.github.io/tag/graphics.html">
                graphics
                        <span class="badge">(2)</span>
                </a>
            </li>
            <li class="tag-2">
                <a href="https://theodox.github.io/tag/gui.html">
                gui
                        <span class="badge">(7)</span>
                </a>
            </li>
            <li class="tag-1">
                <a href="https://theodox.github.io/tag/industry.html">
                industry
                        <span class="badge">(34)</span>
                </a>
            </li>
            <li class="tag-3">
                <a href="https://theodox.github.io/tag/jobs.html">
                jobs
                        <span class="badge">(2)</span>
                </a>
            </li>
            <li class="tag-3">
                <a href="https://theodox.github.io/tag/markdown.html">
                markdown
                        <span class="badge">(3)</span>
                </a>
            </li>
            <li class="tag-2">
                <a href="https://theodox.github.io/tag/math.html">
                math
                        <span class="badge">(5)</span>
                </a>
            </li>
            <li class="tag-1">
                <a href="https://theodox.github.io/tag/maya.html">
                maya
                        <span class="badge">(48)</span>
                </a>
            </li>
            <li class="tag-2">
                <a href="https://theodox.github.io/tag/mgui.html">
                mgui
                        <span class="badge">(10)</span>
                </a>
            </li>
            <li class="tag-3">
                <a href="https://theodox.github.io/tag/minq.html">
                minq
                        <span class="badge">(2)</span>
                </a>
            </li>
            <li class="tag-3">
                <a href="https://theodox.github.io/tag/modeling.html">
                modeling
                        <span class="badge">(2)</span>
                </a>
            </li>
            <li class="tag-3">
                <a href="https://theodox.github.io/tag/modules.html">
                modules
                        <span class="badge">(3)</span>
                </a>
            </li>
            <li class="tag-3">
                <a href="https://theodox.github.io/tag/moonrise.html">
                moonrise
                        <span class="badge">(2)</span>
                </a>
            </li>
            <li class="tag-3">
                <a href="https://theodox.github.io/tag/pipeline.html">
                pipeline
                        <span class="badge">(2)</span>
                </a>
            </li>
            <li class="tag-1">
                <a href="https://theodox.github.io/tag/programming.html">
                programming
                        <span class="badge">(40)</span>
                </a>
            </li>
            <li class="tag-1">
                <a href="https://theodox.github.io/tag/python.html">
                python
                        <span class="badge">(50)</span>
                </a>
            </li>
            <li class="tag-3">
                <a href="https://theodox.github.io/tag/rigging.html">
                rigging
                        <span class="badge">(2)</span>
                </a>
            </li>
            <li class="tag-3">
                <a href="https://theodox.github.io/tag/sfx.html">
                sfx
                        <span class="badge">(2)</span>
                </a>
            </li>
            <li class="tag-1">
                <a href="https://theodox.github.io/tag/techart.html">
                techart
                        <span class="badge">(22)</span>
                </a>
            </li>
            <li class="tag-1">
                <a href="https://theodox.github.io/tag/tools.html">
                tools
                        <span class="badge">(16)</span>
                </a>
            </li>
            <li class="tag-2">
                <a href="https://theodox.github.io/tag/unity.html">
                unity
                        <span class="badge">(4)</span>
                </a>
            </li>
            <li class="tag-2">
                <a href="https://theodox.github.io/tag/web.html">
                web
                        <span class="badge">(6)</span>
                </a>
            </li>
      </ul>
      </nav>
    </div>


  </aside>
  <main>

    <nav>
      <a href="https://theodox.github.io">    Home
</a>

      <a href="/about">About...</a>
      <a href="/pages/pub">Publications</a>
      <a href="/pages/cookbook">Cookbook</a>
      <a href="/archives">By date</a>
      <a href="/tags">By subject</a>

      <a href="https://theodox.github.io/feeds/atom.xml">    Atom
</a>

      <a href="https://theodox.github.io/feeds/rss.xml">    RSS
</a>
    </nav>

<article class="single">
  <header>
      
    <h1 id="pythonception">Pythonception!</h1>
    <p>
          Posted on Thu 15 November 2018 in <a href="https://theodox.github.io/category/blog.html">blog</a>


    </p>
  </header>


  <div>
    <p><img alt="" src="https://i.imgflip.com/2mpbwr.jpg"></p>
<p>Even though serious Maya tools development has been done in Python for almost a decade now, Python still doesn&#8217;t get a lot of love from Maya when the application starts&nbsp;up.  </p>
<p>You can run a <code>userSetup.py</code>, which isn&#8217;t bad &#8212; but it isn&#8217;t very flexible: you&#8217;re going to get one, and only one chance with userSetup, which makes things a lot more complicated if you have support a bunch of possible configurations, like different projects or different tool setups for different specialists; you don&#8217;t want to either physically swap userSetup files all the time, or to try to make one that&#8217;s complex and flexible enough to handle all your needs.  And, of course, a lot of users have their own userSetups and they get mad when you want to take them&nbsp;away.</p>
<p>Unsurprisingly. many teams end up with dedicated launchers &#8212; either dedicated applications or just .<span class="caps">BAT</span> files &#8212; whose job it is to configure maya on startup.  For example you might keep parallel userSetup/code combinations in different locations and then launch Maya with an .<span class="caps">BAT</span> that manipulates <code>sys.path</code> or <code>PYTHONPATH</code> to get the right version to the top of the list.  These kinds of systems work reasonably well, although they also complicate your support structure &#8212; when you&#8217;re trying to add a new artists to the team you need to train them out of just launching Maya from the applications menu, and if you&#8217;re supporting outsources or partner studios you need to distribute the launcher infrastructure as well as the code that does the actual&nbsp;work.</p>
<p>If you stick with the simple stuff, on the other hand&#8230; well, <span class="caps">BAT</span> files are just nasty &#8212; they&#8217;re the computing equivalent of truckstop corn dogs that have been rolling under the heatlamp since&nbsp;1984.</p>
<p>In the words of the great <a href="https://pyvideo.org/speaker/raymond-hettinger.html">Raymond Hettinger</a>, <em>there&#8217;s got to be a better way.</em>  A way you can distribute a toolkit&nbsp;that&#8217;s:</p>
<p><strong>Easy to activate</strong>
It won&#8217;t require me to fire up a different program just to use the one I want to&nbsp;use.</p>
<p><strong>A good citizen</strong>
It doesn&#8217;t force me to reorganize my Maya install (particularly if I&#8217;m an outsource who might only be using this toolkit for a few&nbsp;weeks!).</p>
<p><strong>Install Free</strong>
It doesn&#8217;t demand a separate installer or a plugin or anything else I don&#8217;t already&nbsp;have.</p>
<p>&#8230; but at the same time&nbsp;it&#8217;s</p>
<p><strong>Fully functional</strong>
You can&#8217;t compromise the depth of what you&#8217;re delivering just in order to make it easy to&nbsp;deliver.</p>
<p>The first three are actually surprisingly easy.  After all, Maya has always has it&#8217;s own dedicated script file type &#8212; you can always double-click or drag-and-drop a mel file and it will just work.  No installation, not configuration, not even any special rules about where the file has to be. You can mail somebody a <span class="caps">MEL</span> file and they can just run it from their downloads&nbsp;folder.</p>
<p>Alas, it works in <span class="caps">MEL</span>.  Which is to say, it&#8217;s going to be an uphill battle to make it hit that last bullet point and be fully functional. And how much power can you really pack into a single <span class="caps">MEL</span>&nbsp;file?</p>
<p>But, as Ray would say, <em>there is a better way</em>.</p>
<p>If you&#8217;ve ever had to write one of those <span class="caps">BAT</span> file launchers, you may have seen something like&nbsp;this:</p>
<div class="highlight"><pre><span></span>maya.exe -c <span class="s2">&quot;python(\&quot;import sys; sys.path.insert(0, &#39;c:\\path\\to\\mayatools&#39;); import mayatools; maytools.run()\&quot;)&quot;</span>
</pre></div>


<p>That&#8217;s telling Maya to run a <span class="caps">MEL</span> command that in turn tells Python to add a folder to the path and then run.  Conceptually simple, if ugly as sin; and fine enough for a one liner.  Not, however, the stuff of which great programs are made &#8212; those string escapes alone are enough to make one want to take a hot&nbsp;shower.</p>
<p>You can make things a bit better if you delegate the work to an actual Python file; that gets you down to something&nbsp;like:</p>
<div class="highlight"><pre><span></span>maya.exe -c <span class="s2">&quot;python(\&quot;execfile &#39;c:\\path\\to\\mayatools\\mayatools.py&#39;)\&quot;)&quot;</span>
</pre></div>


<p>One easy thing to do from here is simply to convert these BATs to <span class="caps">MEL</span> files &#8212; after all, they&#8217;re really just calling <span class="caps">MEL</span> anyway.  That gets you doen to one less layer of string escapes (you&#8217;re still stuck quoting all the python, alas) and it will let you run Python from anywhere. In many scenarios this is a good, low-maintenance way forward.  You can create dedicated <span class="caps">MEL</span> launchers that can fire up Python as needed without actually mucking around in the depths of your Maya install directory, without dedicated launchers, and without even writing more than the teensiest smidgen of <span class="caps">MEL</span>.  Heck, this even works with&nbsp;drag-and-drop!</p>
<p>However it&#8217;s not perfect.  The main weakness of something like this &#8212; and with <span class="caps">BAT</span> files, for that matter &#8212;  comes when you start to wonder where, exactly, the relevant python files are.  As soon as the logic gets more complex than a hard-coded path name you&#8217;re suddenly back in the business of trying to write a complex algorithm in <span class="caps">MEL</span> without all of the nice tools you get in Python.  Sometimes you need the power of Python to unleash the power of Python&#8230; it&#8217;s a sort of snake-eating-its-own-tail&nbsp;situation.</p>
<p>To escape from that conundrum you really just need to figure out a way to squeeze the Python logic into thae executable shell of that <span class="caps">MEL</span> file.  Unfortunately, with all those stupid string escape codes, that&#8217;s not a trivial task.  Unless &#8212; let&#8217;s get really meta here for a moment &#8212; you use the power of Python to get <span class="caps">MEL</span> to help you unleash the power of&nbsp;Python. </p>
<p><em>Whaaaaat?</em></p>
<p><img alt="" src="https://i.pinimg.com/originals/c8/b5/b4/c8b5b4debe30a812871382f978e227a4.jpg"></p>
<blockquote>
<p>Using Python to make <span class="caps">MEL</span> to make Python&#8230;?&#8221; <strong>Pythonception!</strong></p>
</blockquote>
<p>The problem with jamming complex code into your <span class="caps">MEL</span> is all the string escaping. But Python comes with built-in tools for dealing with string-safe encoding of arbitrary data &#8212; including strings.  The <code>base64</code> moduie is used to encode aribtrary data for transmission over the internet as blocks of characters.  For example you can take a string&nbsp;like </p>
<div class="highlight"><pre><span></span><span class="n">example</span> <span class="o">=</span> <span class="s1">r&#39;This is a long string, including punctuation and &quot;difficult&quot; characters like quotes\slashes&#39;</span>
</pre></div>


<p>and turn it into something that will not require special&nbsp;escapes:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">base64</span>
<span class="k">print</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64_urlsafeencode</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>
<span class="c1">#  VGhpcyBpcyBhIGxvbmcgc3RyaW5nLCBpbmNsdWRpbmcgcHVuY3R1YXRpb24gYW5kICJkaWZmaWN1bHQiIGNoYXJhY3RlcnMgbGlrZSBxdW90ZXNcc2xhc2hlcw==</span>
</pre></div>


<p>Base64encoding doesn&#8217;t use the full ascii character set, and the <code>b64_urlsafeencode</code> in particular avoids slashes &#8212; so you can be sure that your big blob or random characters will not cause <span class="caps">MEL</span> to fritz&nbsp;out.</p>
<p>This kind of packing gives you the means to take a whole Python file &#8212; as much code as you need to find your install directory, or download updates from the network, or sync up to perforce &#8212; and jam it right into your <span class="caps">MEL</span> file. Here&#8217;s about all you need to compile a Python file to <span class="caps">MEL</span>:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">python_to_mel</span><span class="p">(</span><span class="n">pythonfile</span><span class="p">,</span> <span class="n">melfile</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pythonfile</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
        <span class="n">py_code</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">encoded</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64_urlsafeencode</span><span class="p">(</span><span class="n">py_code</span><span class="p">)</span>
    <span class="n">py_to_mel</span> <span class="o">=</span> <span class="s2">&quot;import base64; _py_code = b64_urlsafedecode(&#39;</span><span class="si">%s</span><span class="s2">&#39;); exec py_code&quot;</span>  <span class="o">%</span> <span class="n">encoded</span> 
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">melfile</span><span class="p">,</span> <span class="s1">&#39;wt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;python(&quot;</span><span class="si">%s</span><span class="s1">&quot;);&#39;</span> <span class="o">%</span> <span class="n">py_to_mel</span>
</pre></div>


<p>Now, when you double-click that Mel file the original code &#8212; safely stashed away inside that block of gibberish &#8212; will be turned back into code and run as if you&#8217;d typed it into the script&nbsp;listener.  </p>
<p>Incidentally if something goes wrong you can see the actual text fo the Python code in Maya &#8212; in the example above it&#8217;s stashed in variable called <code>_py_code</code>, which will be in the global namespace (again exactly as if you had typed it in the&nbsp;listener).</p>
<p>While you can certainly achieve the same end in different ways, this method as a lot of appeal, particularly because it gives you a maximal amount of power without any infrastructure on the receiving end.  You could email a <span class="caps">MEL</span> file like that to anybody and they could run it as is.  Anything in the standard library &#8212; including important things like the ability to download an update from an http server or to call out to a source control program &#8212; can now be done from a vanilla <span class="caps">MEL</span> file.  It&#8217;s almost enough to make you like <span class="caps">MEL</span> again&#8230; it&#8217;s like the good old days of&nbsp;2005.</p>
<p>Of course you&#8217;ll quickly run into the other big hassle of Maya startup, which is setting up the rest of your Python environment: the endless old struggle of <span class="caps">PATH</span> and <span class="caps">PYTHONPATH</span> and the rest.  But don&#8217;t worry! <span class="caps">MEL</span> has an answer for that as well&#8230; but it&#8217;s an answer that will wait until next&nbsp;time.</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://theodox.github.io/tag/python.html">python</a>
      <a href="https://theodox.github.io/tag/maya.html">maya</a>
      <a href="https://theodox.github.io/tag/programming.html">programming</a>
      <a href="https://theodox.github.io/tag/distribution.html">distribution</a>
      <a href="https://theodox.github.io/tag/mel.html">MEL</a>
    </p>
  </div>

<!--
  <div class="center social-share">
    <div class="addthis_native_toolbox"></div>
    <div class="addthis_sharing_toolbox"></div>
    <div class="addthis_inline_share_toolbox"></div>
  </div>
-->


    <div class="addthis_relatedposts_inline"></div>


<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'theodoxcom';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
        Please enable JavaScript to view comments.

</noscript>
<!-- End Disqus -->
</article>

    <footer>
<p>&copy;  2018</p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Chimeras & Manticores ",
  "url" : "https://theodox.github.io",
  "image": "",
  "description": ""
}
</script>


    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-575daef5596b169a"></script>

</body>
</html>