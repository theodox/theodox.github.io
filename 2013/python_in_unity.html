<!DOCTYPE html>
<html lang="en">
<head>
          <title>Chimeras & Manticores</title>
        <meta charset="utf-8" />
        <link href="http://theodox.com/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Chimeras & Manticores Full Atom Feed" />
        <link href="http://theodox.com/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="Chimeras & Manticores Full RSS Feed" />



    <meta name="tags" content="unity" />
    <meta name="tags" content="python" />
    <meta name="tags" content="programming" />
    <meta name="tags" content="techart" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://theodox.com/">Chimeras & Manticores <strong>technical art, python, the games business, and obscurantism</strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
            <li><a href="/about">About...</a></li>
            <li><a href="/pages/pub">Publications</a></li>
            <li><a href="http://astore.amazon.com/tecsurgui-20">Tech-Art Book Store</a></li>
            <li><a href="/pages/cookbook">Cookbook</a></li>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="http://theodox.com/2013/python_in_unity" rel="bookmark"
         title="Permalink to Embedding IronPython in Unity = Tech-art hogÂ heaven">Embedding IronPython in Unity = Tech-art hog&nbsp;heaven</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2013-12-21T11:14:00.001000-08:00">
      Sat 21 December 2013
    </abbr>
    <address class="vcard author">
      By           <a class="url fn" href="http://theodox.com/author/steve-theodore.html">Steve Theodore</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <blockquote>
<p><strong>Update 6/2/2015</strong> If you are relatively new to Unity, and you&#8217;re here because you&#8217;re looking for ways to work in Python rather than C#, you may also want to check out <a href="boo-who.html">this 2015 post</a> about Boo - the very obscure, but very Python-like language in Mono that lets you write Unity games with fast, compiled code by almost-Python syntax.  It&#8217;s always been a part of Unity but a lot of people never knew it was&nbsp;there.</p>
</blockquote>
<p>You don&#8217;t work long in games without griping about your engine, and I&#8217;ve got my share of complaints about Unity. But I have to admit that it&#8217;s the best toy in the world for a classic tech-art geek personality. Unlike bigger, more powerful <span class="caps">AAA</span> engines, Unity lets you get in under the hood really quickly. The editor environment is extremely extensible - you can add not just dialogs and buttons but 3d widgets and <a href="http://www.thewanderlust.net/blog/2010/03/29/user-interface-design-in-video-games/">diegetic <span class="caps">UI</span> </a>.   </p>
<p>When I first got my hands on Unity I was a bit disappointed to note that, unlike Maya, it doesn&#8217;t include a built in interactive console environment. The console is a wonderful thing for a <span class="caps">TA</span> - it&#8217;s great for printing out data, lightweight automation of the &#8220;find everything in the scene named &#8216;foo&#8217; and rename it to &#8216;bar&#8217;&#8221; variety. So, I thought, is there some way to get this into Unity?  The fact that one could even ask it is a tribute to how flexible Unity is - and as it turned out it was not only possible, it wasn&#8217;t too&nbsp;hard.  </p>
<h2>You got Python in my&nbsp;Unity!</h2>
<p>To start with a console needs some kind of scripting language. Not surprisingly, I wanted to see I could do it in Python. Fortunately, this is ridiculously easy thanks to <a href="http://ironpython.codeplex.com/">IronPython</a>, the dotnet flavor of Python.  IronPython  runs on dotnet, and so does Unity - so it&#8217;s not tough to plug IronPython into Unity directly.  Here&#8217;s&nbsp;how:  </p>
<ol>
<li>You need a verstion of IronPython that will run on Unity&#8217;s version of <a href="http://www.mono-project.com/Main_Page">Mono </a>, which as of this writing (Unity 4.22 , late 2013) is version 2.6.  By a happy coincidence of naming, that points you at <a href="http://ironpython.codeplex.com/downloads/get/159511">IronPython 2.6.2</a>.  (I&#8217;ve tried later versions but without much&nbsp;luck).</li>
<li>Locate the IronPython dlls and the IronPython stdlib in the zip file. You will need<br />
    _
        - IronPython.dll
        - IronPython.Modules.dll
        - Microsoft.Scripting.Core.dll
        - Microsoft.Scripting.dll
        - Microsoft.Scripting.Debugging.dll
        - Microsoft.Scripting.ExtensionAttribute.dll
        -&nbsp;Microsoft.Dynamic.dll</li>
<li>If you want access to the Python stdlib, you&#8217;ll also need to grab a copy of the python 2.6 /Lib folder &#8212; this is <a href="http://techartsurvival.blogspot.com/2013/12/python-in-unity-minor-correction.html">not distributed with IronPython 2.6</a>.  I unzipped the Python26.zip file from my Maya bin directory into the /Lib folder, taking care to leave the handful of IronPython files already&nbsp;there</li>
<li>Copy all of the above into an <strong>Editor/Plugins/Resources</strong> folder in Unity. If you&#8217;re not sure what that means:<ul>
<li>Naming a folder <em>Editor</em> tells Unity it only runs in the editor, not at runtime (IronPython <em>won&#8217;t</em> run inside Unity on <span class="caps">IOS</span> devices, since those never run editor&nbsp;code). </li>
<li>Naming it a folder <em>Plugins</em> tells Unity to load dlls from&nbsp;it</li>
<li>Naming a folder <em>Resources</em> makes sure it loads before scripts are compiled
For our application we need all three, hence &#8220;Editor/Plugins/Resources/&#8230;&#8221;  You can stick that whole thing into a top level folder for cleanliness if you want. Note the path names in this example:<br />
<a href="http://3.bp.blogspot.com/-uHVdPvrDduM/Uq_uSf5ZxNI/AAAAAAAABO0/H0PMXUJlFso/s1600/layout.png"><img alt="" src="http://3.bp.blogspot.com/-uHVdPvrDduM/Uq_uSf5ZxNI/AAAAAAAABO0/H0PMXUJlFso/s640/layout.png" /></a></li>
</ul>
</li>
<li>Restart Unity and open up MonoDevelop. If you check the Assembly-CSharp Editor info in the Solution panel you should see all of your IronPython <span class="caps">DLL</span>&#8217;s are referenced therein:<br />
<a href="http://3.bp.blogspot.com/-A_kG1rnuiuY/Uq_vrq1bXhI/AAAAAAAABPA/b9v7p3wxpfw/s1600/assembl.png"><img alt="" src="http://3.bp.blogspot.com/-A_kG1rnuiuY/Uq_vrq1bXhI/AAAAAAAABPA/b9v7p3wxpfw/s400/assembl.png" /></a></li>
</ol>
<p>Once you&#8217;ve verified that the <span class="caps">DLL</span>&#8217;s are in place, its time to test them.  Hosting an IronPython session in another app is much simpler than it sounds. The best resource for how it works is <a href="http://www.voidspace.org.uk/ironpython/embedding.shtml">Michael Foord&#8217;s Voidspace site</a> (his <a href="http://www.manning.com/foord/">book on IronPython</a> is a great resource if you plan on going far with this , btw) . However in overview the process is pretty&nbsp;simple:</p>
<ol>
<li>Create a [<code>Microsoft.Hosting.ScriptEngine</code>]((https://github.com/IronLanguages/main/blob/master/Runtime/Microsoft.Scripting/Hosting/ScriptEngine.cs). This is the actual Python&nbsp;interpreter.</li>
<li>Create a  <a href="https://github.com/IronLanguages/main/blob/master/Runtime/Microsoft.Scripting/Hosting/ScriptScope.cs"><code>Microsoft.Hosting.ScriptScope</code></a> This corresponds to the global namespace of your interpreter - much like the interpeter namespace in&nbsp;Maya</li>
<li>Create  a <a href="https://github.com/IronLanguages/main/blob/master/Runtime/Microsoft.Scripting/Hosting/ScriptSource.cs"><code>Microsoft.Hosting.ScriptSource</code></a> using some text you&#8217;ve entered or&nbsp;composed.</li>
<li>Execute the&nbsp;script</li>
<li>Rinse <span class="amp">&amp;</span> Repeat. You are in&nbsp;business!</li>
</ol>
<h2>Script hosting in&nbsp;practice</h2>
<p>Here&#8217;s an example .cs script that demostrates the process. Put it in an editor folder so that it can access the Unity Editor assembly (it&#8217;s probably a good idea to keep it in the editor folder where you have your plugins/resources folder for&nbsp;cleanliness).   </p>
<div class="highlight"><pre><span></span> using UnityEngine;    
 using UnityEditor;    
 using IronPython;    
 using IronPython.Modules;    
 using System.Text;    
 // derive from EditorWindow for convenience, but this is just a fire-n-forget script    
 public class ScriptExample : EditorWindow {    
     [MenuItem(&quot;Python/HelloWorld&quot;)]    
     public static void ScriptTest()    
     {    
         // create the engine    
         var ScriptEngine = IronPython.Hosting.Python.CreateEngine();    
         // and the scope (ie, the python namespace)    
         var ScriptScope = ScriptEngine.CreateScope();    
         // execute a string in the interpreter and grab the variable    
         string example = &quot;output = &#39;hello world&#39;&quot;;    
         var ScriptSource = ScriptEngine.CreateScriptSourceFromString(example);    
         ScriptSource.Execute(ScriptScope);    
         string came_from_script = ScriptScope.GetVariable&lt;string&gt;(&quot;output&quot;);    
         // Should be what we put into &#39;output&#39; in the script.    
         Debug.Log(came_from_script);                
     }    
 }
</pre></div>


<p>When it compiles you&#8217;ll get a menu items that activates the script.  When you hit it you should get a debug printout in your console like&nbsp;so.  </p>
<p><a href="http://4.bp.blogspot.com/-OHCa77GIxGA/UrEnF442YzI/AAAAAAAABPQ/nYBOKL4W1ZI/s1600/hello+world.jpg"><img alt="" src="http://4.bp.blogspot.com/-OHCa77GIxGA/UrEnF442YzI/AAAAAAAABPQ/nYBOKL4W1ZI/s1600/hello+world.jpg" /></a></p>
<p>Like the Maya python interpreter, you need to import the appropriate names so that you can get to them in scripts (it&#8217;s always rather boggled my mind that Maya&#8217;s own interpreter requires you to import cmds or pymel <em>every single freakin&#8217; time</em>.  IronPython lets you import dotnet assemblies as if they were python modules, and since Unity and the Unity Editor are dotnet assemblies you can get access to the entire Unity environment just by importing them into your&nbsp;interpreter.   </p>
<p>First, we need to load the assemblies to make them available to the intpereter itself.  In dotnet land that&#8217;s done by loading an assembly.  Once an assembly is loaded, it can be imported using typical Python&nbsp;syntax  </p>
<div class="highlight"><pre><span></span> <span class="p">[</span><span class="n">MenuItem</span><span class="p">(</span><span class="s2">&quot;Python/HelloWorldRuntime&quot;</span><span class="p">)]</span>    
 <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">UnityScriptTest</span><span class="p">()</span>    
 <span class="p">{</span>    
     <span class="o">//</span> <span class="n">create</span> <span class="n">the</span> <span class="n">engine</span> <span class="n">like</span> <span class="n">last</span> <span class="n">time</span>    
     <span class="n">var</span> <span class="n">ScriptEngine</span> <span class="o">=</span> <span class="n">IronPython</span><span class="o">.</span><span class="n">Hosting</span><span class="o">.</span><span class="n">Python</span><span class="o">.</span><span class="n">CreateEngine</span><span class="p">();</span>    
     <span class="n">var</span> <span class="n">ScriptScope</span> <span class="o">=</span> <span class="n">ScriptEngine</span><span class="o">.</span><span class="n">CreateScope</span><span class="p">();</span>    
     <span class="o">//</span> <span class="n">load</span> <span class="n">the</span> <span class="n">assemblies</span> <span class="k">for</span> <span class="n">unity</span><span class="p">,</span> <span class="n">using</span> <span class="n">the</span> <span class="n">types</span> <span class="n">of</span> <span class="n">GameObject</span>    
     <span class="o">//</span> <span class="ow">and</span> <span class="n">Editor</span> <span class="n">so</span> <span class="n">we</span> <span class="n">don</span><span class="s1">&#39;t have to hardcoded paths    </span>
     <span class="n">ScriptEngine</span><span class="o">.</span><span class="n">Runtime</span><span class="o">.</span><span class="n">LoadAssembly</span><span class="p">(</span><span class="n">typeof</span><span class="p">(</span><span class="n">GameObject</span><span class="p">)</span><span class="o">.</span><span class="n">Assembly</span><span class="p">);</span>    
     <span class="n">ScriptEngine</span><span class="o">.</span><span class="n">Runtime</span><span class="o">.</span><span class="n">LoadAssembly</span><span class="p">(</span><span class="n">typeof</span><span class="p">(</span><span class="n">Editor</span><span class="p">)</span><span class="o">.</span><span class="n">Assembly</span><span class="p">);</span>    
     <span class="n">StringBuilder</span> <span class="n">example</span> <span class="o">=</span> <span class="n">new</span> <span class="n">StringBuilder</span><span class="p">();</span>    
     <span class="n">example</span><span class="o">.</span><span class="n">AppendLine</span><span class="p">(</span><span class="s2">&quot;import UnityEngine as unity&quot;</span><span class="p">);</span>    
     <span class="n">example</span><span class="o">.</span><span class="n">AppendLine</span><span class="p">(</span><span class="s2">&quot;import UnityEditor as editor&quot;</span><span class="p">);</span>    
     <span class="n">example</span><span class="o">.</span><span class="n">AppendLine</span><span class="p">(</span><span class="s2">&quot;unity.Debug.Log(</span><span class="se">\&quot;</span><span class="s2">hello from inside the editor</span><span class="se">\&quot;</span><span class="s2">)&quot;</span><span class="p">);</span>    
     <span class="n">var</span> <span class="n">ScriptSource</span> <span class="o">=</span> <span class="n">ScriptEngine</span><span class="o">.</span><span class="n">CreateScriptSourceFromString</span><span class="p">(</span><span class="n">example</span><span class="o">.</span><span class="n">ToString</span><span class="p">());</span>    
     <span class="n">ScriptSource</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">ScriptScope</span><span class="p">);</span>    
 <span class="p">}</span>
</pre></div>


<p>Running that one generates another console message - but this time from inside the&nbsp;script!  </p>
<p><a href="http://3.bp.blogspot.com/-S6g8MqlQ4gg/UrEub33XuBI/AAAAAAAABPg/kJmAVPdZtAI/s1600/hello+2.png"><img alt="" src="http://3.bp.blogspot.com/-S6g8MqlQ4gg/UrEub33XuBI/AAAAAAAABPg/kJmAVPdZtAI/s1600/hello+2.png" /></a></p>
<h2>Next time: building a&nbsp;console</h2>
<p>That may not seem like much, but in reality it&#8217;s a big deal. You&#8217;ve got a working script interpreter running in Unity now, with all the power of Python and access to the innards of the Unity environment.  What remains is to build a decent interactive&nbsp;environment. </p>
<p>If you&#8217;re content with something barebones, you can whip up a simple <span class="caps">UI</span> to allow you to type code into a text field and see the results in another text block.  That may be enough for some purposes (hell, half the 3d packages on the market do little more than that).  However a more featured editor is a little tougher and involves a  little hacking to work around the limitations of Unity&#8217;s <span class="caps">GUI</span> text handling, which makes it a bit involved for a single post. I&#8217;ll save that one for next&nbsp;time  </p>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>