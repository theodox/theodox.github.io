<!DOCTYPE html>
<html lang="en">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">


        <title>Maya GUI II: All Your Base Classes Are Belong To Us</title>

            <link href="http://blog.theodox.com/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="theodox.com Full Atom Feed" />
            <link href="http://blog.theodox.com/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="theodox.com Full RSS Feed" />
        <!-- Bootstrap Core CSS -->
        <link href="../theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="../theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="../theme/css/code_blocks/zenburn.css" rel="stylesheet">


        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->



        <meta name="description" content="Introducing mGui, a module for making Maya GUI coding more pythonic and less infuriating.">

        <meta name="author" content="Steve Theodore">

        <meta name="tags" content="Maya">
        <meta name="tags" content="python">
        <meta name="tags" content="GUI">
        <meta name="tags" content="programming">

	                <meta property="og:locale" content="">
		<meta property="og:site_name" content="theodox.com">

	<meta property="og:type" content="article">
            <meta property="article:author" content="../author/steve-theodore.html">
	<meta property="og:url" content="../2014/all_your_base">
	<meta property="og:title" content="Maya GUI II: All Your Base Classes Are Belong To Us">
	<meta property="article:published_time" content="2014-03-28 09:30:00-07:00">
            <meta property="og:description" content="Introducing mGui, a module for making Maya GUI coding more pythonic and less infuriating.">

            <meta property="og:image" content="../theme/images/post-bg.jpg">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="../">theodox.com</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                        <li><a href="/about">About...</a></li>
                        <li><a href="/pages/pub">Publications</a></li>
                        <li><a href="http://astore.amazon.com/tecsurgui-20">Tech-Art Book Store</a></li>
                        <li><a href="/pages/cookbook">Cookbook</a></li>

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('../theme/images/post-bg.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Maya GUI II: All Your Base Classes Are Belong To Us</h1>
                        <span class="meta">
                            Fri 28 March 2014
                        </span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <article>
        <blockquote>
<p>I've left this article mostly intact, but some elements of the syntax have changed in mGui 2.0.  The big changes, generally speaking, are under the hood -- but the 2.0 version uses pep-8 style naming so the capital letters for properties have been replaced with lower-case ones. See the <a href="mGui_updates_2">mGui updates</a> post for a more up-to-date view of the current mGui syntax</p>
</blockquote>
<p>In <a href="rescuing_maya_gui_from_itself.html">Rescuing Maya GUI From Itself</a> I talked in some detail about how to use descriptors and metaclasses to create a wrapper for the Maya GUI toolkit that, er, sucks less than the default implementation. I also strove mightily to include a lot of more or less irrelevant references to <a href="http://www.youtube.com/watch?v=BfIAKj3Gl1E">Thunderbirds</a>. This time out I want to detail what a working implementation of the ideas I sketched out there looks like.<br />
<img alt="" src="http://fc06.deviantart.net/fs70/f/2010/282/6/a/all_your_base_by_ultimathegod-d30fu0f.jpg" />  </p>
<p>I think this time the irrelevant thematic gloss will come from <a href="http://knowyourmeme.com/memes/all-your-base-are-belong-to-us">All Your Base Are Belong To Us</a> jokes. Because (a), we’re talking about base classes, (b) what could be more retro and 90’s than Maya’s GUI system, and (c) <strong>For Great Justice, Make All Zig!</strong>  </p>
<p>I’ve put my current stab at a comprehensive implementation up on Github, in the form of the <a href="https://github.com/theodox/mGUI">mGUI project</a> , where you can poke at it to your heart’s content. The whole project is there, and it’s all free to use under the MIT, <a href="http://opensource.org/licenses/MIT"><em>‘do-what-thou-wilt-but-keep-the-copyright-notice’</em></a> license. Enjoy! I should warn you, though, that this is still W.I.P code, and is evolving all the time! Use it at your own risk – things may change a lot before its really ‘ready’.   </p>
<h2>All Your Properties Are Belong To Our Base Class</h2>
<p><img alt="" src="http://fc00.deviantart.net/fs30/f/2008/064/8/0/All_your_base_are_belong_to_us_by_Sky_roxorz_815.png" /> </p>
<p>What we’re shooting for is a library that provides all of Maya;’s GUI widgets in a clean, pythonic way without making anybody learn too much new stuff. If all goes well, the result is a cleaned up and more efficient version of things most of us already know. You can also treat this an template for how you might want to to wrap other aspects of Maya – say, rendering or rigging – in cleaner code.  </p>
<p>From last time, we know we can wrap a Maya GUI component in a class which uses <a href="http://nbviewer.ipython.org/urls/gist.github.com/ChrisBeaumont/5758381/raw/descriptor_writeup.ipynb">descriptors</a> to make conventional property access work. The main thing we’re going to be delivering in this installment is a slew of classes that have the right property descriptors to replicate the Maya GUI toolkit. We’ll be using the metaclass system we showed earlier to populate the classes (if none of this makes sense, you probably want to <a href="rescuing_maya_gui_from_itself.html">hop back to the previous blog entry</a> before following along).<br />
To keep things simple and minimize the boilerplate, we’ll want to derive all of our concrete classes – the widgets and layouts and so on – from a single base. This helps the code simple and ensure that the features we add work the same way for the whole library. We’ll add a second class later to handle some details specific to layouts, but that will derive from the base class.<br />
Before we look at the details of the base class, we should think a little more about the properties. In the last installment, we treated all properties the same way - as generic wrappers around Maya.cmds. In a production setting, though, we want to distinGUIsh between 3 types of properties:  </p>
<h4>Regular properties</h4>
<p>These are just wrapped accesses to commands, like we demonstrated last week. They use the same ControlProperty class as we used last time to call commands on our GUI widgets.</p>
<h4>Read-only properties</h4>
<p>A small number of Maya GUI commands are read-only. It would be nice and more pythonic to make sure that these behave appropriately. So, ControlProperty has been tweaked with a flag that allows it to operate as a read-only property; otherwise it’s just the same descriptor we talked about last time out. ]</p>
<h4>Callbacks</h4>
<p>This one is a bit more involved. I’ve already complained about the weaknesses of the event model in Maya GUI. Cleaning it up starts with knowing which properties are callback properties and treating them accordingly. 
To differentiate between these three types of properties, we need to tweak our old metaclass so that it can distinGUIsh between regular properties, read-only properties, and event properties. Luckily the necessary changes are super simple - basically, we’ll take out the hard-coded list of properties we used before and allow every incoming class to declare a list of properties, a list of read-onlies, and a list of callbacks. (if you want to compare, the version from last time is <a href="https://gist.github.com/theodox/9106311">here</a>):  </p>
<h2>Somebody Set Us Up The Bomb!</h2>
<p>Before getting into the nitty-gritty of our overall widget class, I want to make a side noted about the special properties used for the callbacks. These CallbackProperty descriptors are slightly different from the familiar ControlProperty. Their job is to de-couple the Maya GUI widget from the commands it fires. They create special delegate objects which will intercept callbacks fired by our GUI objects.  </p>
<p>If you have experimented a little with last time’s code, you may already have seen that it works just as well for callbacks and commands as for other properties. So you may wonder why we should bother to treat callbacks differently. What’s the point?  </p>
<p>There are two main reasons this is a useful complication.<br />
First, and most usefully, event delegates make it easier to add your callbacks after you lay out your GUI, rather than forcing you to interleave your code logic with the process of building forms and layouts. De-coupling the functional code form the graphic display makes for more readable and more maintainable code. It also makes it possible for you to reuse fairly generic layouts with different back ends. In pseudo-code:  </p>
<div class="highlight"><pre><span></span>Layout  
   Layout  
     ButtonA  
     ButtonB  
   Layout  
     ButtonC  
     ListA

ButtonA deletes selected item from ListA  
ButtonB renames selected item from ListA  
ButtonC adds new item to ListA
</pre></div>


<p>as opposed to  </p>
<div class="highlight"><pre><span></span>Layout  
   Layout   
     ButtonA.   
        I&#39;m going to delete something from the list when it gets made  
     ButtonB  
        I&#39;m going to rename something in the list when it gets made  
   Layout  
     ButtonC  
        I&#39;m going to add something to the list when it gets made  
     ListA
</pre></div>


<p>Keeping the functional bits separate makes it easy to, say, split the purely visual layout details into a separate file, but more importantly makes it clear whats an administrative detail and what’s actual functionality.<br />
On a second, more tactical level the proxies also allow you to attach more than one function to a callback. It’s pretty common, for example, that you the act of want selecting an item in a list to select object in the Maya scene, but also to enable some relevant controls and maybe check with a database or talk to source control. Using an event proxy lets you handle those different tasks in three separate functions instead of one big monster that mixes up lots of UI feedback and other concerns.  </p>
<p><img alt="" src="https://images-blogger-opensocial.googleusercontent.com/gadgets/proxy?url=http%3A%2F%2F3.bp.blogspot.com%2F-OFyQFgarV3I%2FUmU6BLY68jI%2FAAAAAAAAA6g%2FHSk55Z2R5Io%2Fs1600%2FPantallazo-1.png&amp;container=blogger&amp;gadget=a&amp;rewriteMime=image%2F*" />  </p>
<p>If you’re familiar with QT you’ll rexognize that event delegates are basically QT “Signals”  </p>
<p>So that’s why the extra complexity is worth it.  </p>
<p>The actual workings of the proxy class are documented in the <a href="https://github.com/theodox/mGUI/blob/master/mGUI/events.py">events.py file in the Github project</a>; I’ll get back to how those work in a future post. Details aside, they key takeaway for right now is that this setup helps us move towards GUI code that’s more declarative. That’s the other reason why <code>button.label = “Reset”</code> is better than <code>cmds.Button(self.activeButton, e=True, l="Reset"</code>– it’s not just less typing. The real value comes from treating the GUI layout as <strong>data</strong> rather than <strong>code</strong>. That means you can concentrate on the actual work of your tools rather than the fiddly details of highlighting buttons or whatever.<br />
Last but not least - by standardizing on the event mechanism we have an easy way to standardize the information that comes with the callback events for very little extra works. So, for example, all of the callbacks include a dictionary of keyword arguments when they fire - and the dictionary includes a reference to the widget that fired the event. That way it’s easy to write a generic event handler and not have to manually bind the firing control to a callback function.  </p>
<blockquote>
<p>While we’re on the topic of de-coupling: Wouldn’t it be nice to separate out the details of the visuals (“what color is that button?”) from the structure of the forms and layouts?. Spoiler alert! This is a topic for a future post – but the curious might want to check out <a href="https://github.com/theodox/mGUI/blob/master/mGUI/styles.py">styles.py in the GitHub</a></p>
</blockquote>
<h2>Think ahead</h2>
<p><img alt="" src="http://www.geekytattoos.com/wp-content/uploads/2009/04/all-your-base-tattoo.jpg" />  </p>
<blockquote>
<p>How the hell are you going to explain THAT to your grandchildren?<br />
The obvious lession is THINK AHEAD  </p>
</blockquote>
<hr />
<p>So, we’ve covered our improved property descriptors, and now it’s time to set up our base class.  </p>
<p>This is a great opportunity to do some plumbing for more efficient coding. However it’s also a temptation – when the desire to sneak everything under the sun into your base classes is a recipe for monster code and untraceable bugs. This design should be as simple as we can make it.  </p>
<p>Still, there are a couple of things that it would be nice to put into the base class - they are all very general (as befits base-class functions) and they are all common to any GUI tasks.  </p>
<h2>Tags</h2>
<p>In most GUI systems, you can attach any arbitrary data you want to a widget. For example, you might want to have an array of buttons that all did the same thing with slightly different values, say moving an object by different amounts.  In vanilla Maya, you have to encapsulate the data into your command call: With a tag attached to the buttons, on the other hand, you can write a script that just says "move the target by the amount in this button’s tag", which is much easier to maintain and more flexible. And as we just pointed out, the event mechanism always sends a reference to the control which owns an event when it fires, so it’s easy to get to the right tag when you want it.  </p>
<h2>A real name</h2>
<p>Having explicit names for your pieces is very handy, particularly in large, deeply nested systems like a GUI..  </p>
<p>In conventional Maya coding the names are critical, since they are your only way of contacting the GUI after it’s built. They are also unpredictable, because of Maya’s habit of renaming items to give them unique path names. Luckily for us we don’t need to rely on the widget names from Maya, since we’re managing the GUI items under the hood inside our wrappers. This gets us off the hook for creating and managing variables to capture the results of every GUI command under the sun.  </p>
<p>That said, names are still useful in a big complex system. So, to make it really clear how to find one of our wrappers inside a GUI layout it makes sense to ask for an explicit name passed in as the first argument - that way it’s totally clear what the control is intended to be. </p>
<blockquote>
<p>Note: This system changes slightly in mGui 2.0 (spring, 2016).  The newer syntax allows you to auto-assign keys using local variable names, which involves less redundancy than the original way. Explicit keys still work, however.</p>
</blockquote>
<p>There are, of course, plenty of controls you don’t really care about once they’re made: help text, spaces, separators and so on. To avoid making users have to invent names for those guys, we should let users pass in 0 or False or None as a succinct way of saying “I don’t care about the name of this thing”.  </p>
<p>One minor note: I used <code>Key</code> as the name of the property so my IDE did not bug me for using in the Python reserved word ‘id’. Little things matter :)  </p>
<p>Speaking of little things: there are some great tools in the Python language to make classes more efficient to work with. The so called ‘magic methods’ allow you to customize the behavior of your classes, both to make them feel more Pythonic and to express your intentions more clearly. Here are a couple of the things we can do with the magic methods in our base class:  </p>
<h2><code>__nonzero__</code></h2>
<p>Speaking of that pass-in-zero-to-skip-names gimmick, one simple but super-useful thing we can do is to implement the <code>__nonzero__</code> method. That’s what Python calls when you try the familiar  </p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">something</span><span class="p">:</span>  
    <span class="n">doSomething</span><span class="p">()</span>
</pre></div>


<p>test. In our case, we know that all Maya GUI control commands have the <code>exist</code> flag, and therefore all of our GUI classes will too. So, if our <code>__nonzero__</code> just returns the <code>exist</code> property of our class instances, we can elegantly check for things like dead controls with a simple, pythonic if test.  </p>
<h2><code>__repr__</code></h2>
<p><code>__repr__</code> is what Python calls when you need a printable representation of an object. In our case, we can pass back our underlying Maya GUI object, which is just a GUI path string. This way, you can pass one of our wrapper classes to some other python code that works on GUI objects and it will ‘just work’ – This is more or less what PyMel does for nodes, and it’s a great help when integrating a new module into an existing codebase. Like PyMel’s version there will be some odd corner cases that don’t work but it’s a handy convenience most of the time.  </p>
<p>As a minor tweak, the <code>__repr__</code> is also tweaked to display differently when the GUI widget inside a wrapper class has been deleted. This won’t prevent errors if you try to use the widget, but it is a big help in parsing error messages or stack traces.  </p>
<h3><code>__iter__</code></h3>
<p>The next magic method we want to add is <code>__iter__</code>. It is the what python calls when you try to loop over a list or a tuple.  </p>
<p>Now, a single GUI object obviously is not iterable. A layout like columnLayout, on the other hand, can be iterated since it has child controls. By implementing <code>__iter__</code> here and then over-riding it when we tackle layouts, we can iterate over both layouts and their children in a single call. This makes it easy to look for layout children :  </p>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">mainlayout</span><span class="p">:</span>  
    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">Key</span> <span class="o">==</span> <span class="s1">&#39;cancel&#39;</span><span class="p">:</span> <span class="c1">#.... etc</span>
</pre></div>


<p>So with all those methods added the base Control class looks like this:  </p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Control</span><span class="p">(</span><span class="n">Styled</span><span class="p">,</span> <span class="n">BindableObject</span><span class="p">):</span>  
    <span class="sd">&#39;&#39;&#39;  </span>
<span class="sd">    Base class for all mGUI controls.  Provides the necessary frameworks for CtlProperty and CallbackProperty access to the underlying widget.</span>

<span class="sd">    NOTE this is not exactly identical to the code on github - more advanced stuff is removed to make the progression clearer  </span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># what command do I call?</span>
    <span class="n">CMD</span> <span class="o">=</span> <span class="n">cmds</span><span class="o">.</span><span class="n">control</span>

    <span class="c1"># these will be re-written by the metaclass as property descriptors </span>
    <span class="n">_ATTRIBS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;annotation&#39;</span><span class="p">,</span> <span class="s1">&#39;backgroundColor&#39;</span><span class="p">,</span> <span class="s1">&#39;defineTemplate&#39;</span><span class="p">,</span> <span class="s1">&#39;docTag&#39;</span><span class="p">,</span>  <span class="s1">&#39;enable&#39;</span><span class="p">,</span> <span class="s1">&#39;enableBackground&#39;</span><span class="p">,</span> <span class="s1">&#39;exists&#39;</span><span class="p">,</span> <span class="s1">&#39;fullPathName&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">,</span>  <span class="s1">&#39;manage&#39;</span><span class="p">,</span> <span class="s1">&#39;noBackground&#39;</span><span class="p">,</span> <span class="s1">&#39;numberOfPopupMenus&#39;</span><span class="p">,</span> <span class="s1">&#39;parent&#39;</span><span class="p">,</span> <span class="s1">&#39;popupMenuArray&#39;</span><span class="p">,</span> <span class="s1">&#39;preventOverride&#39;</span><span class="p">,</span> <span class="s1">&#39;useTemplate&#39;</span><span class="p">,</span> <span class="s1">&#39;visible&#39;</span><span class="p">,</span> <span class="s1">&#39;visibleChangeCommand&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">]</span>  
    <span class="n">_CALLBACKS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dragCallback&#39;</span><span class="p">,</span> <span class="s1">&#39;dropCallback&#39;</span><span class="p">,</span> <span class="s1">&#39;visibleChangeCommand&#39;</span><span class="p">]</span>  
    <span class="n">_READ_ONLY</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;isObscured&#39;</span><span class="p">,</span> <span class="s1">&#39;popupMenuArray&#39;</span><span class="p">,</span> <span class="s1">&#39;numberOfPopupMenus&#39;</span><span class="p">]</span>

    <span class="c1"># Activate the metaclass!</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ControlMeta</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Key</span> <span class="o">=</span> <span class="n">key</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">Widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CMD</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">_style</span><span class="p">)</span>  
        <span class="sd">&#39;&#39;&#39;  </span>
<span class="sd">        Widget is the GUI element in the scene  </span>
<span class="sd">        &#39;&#39;&#39;</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">Callbacks</span> <span class="o">=</span> <span class="p">{}</span>  
        <span class="sd">&#39;&#39;&#39;  </span>
<span class="sd">        A dictionary of Event objects  </span>
<span class="sd">        &#39;&#39;&#39;</span>  
        <span class="n">Layout</span><span class="o">.</span><span class="n">add_current</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">register_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callbackName</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>  
        <span class="sd">&#39;&#39;&#39;  </span>
<span class="sd">        when a callback property is first accessed this creates an Event for the specified callback and hooks it to the GUI widget&#39;s callback function  </span>
<span class="sd">        &#39;&#39;&#39;</span>  
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;e&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="n">callbackName</span><span class="p">:</span><span class="n">event</span><span class="p">}</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">CMD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Widget</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
        <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>  
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Widget</span>  
        <span class="k">else</span><span class="p">:</span>  
            <span class="k">return</span> <span class="s2">&quot;&lt;deleted UI element </span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Widget</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
        <span class="k">yield</span> <span class="bp">self</span>
</pre></div>


<p>You’ll notice that it is inheriting from two classes we have not touched on, <code>Styled</code> and <code>BindableObject</code>. Those don’t interact with what we’re doing here - they’ll come up in a later post. You can pretend it just says ‘object’. If you’re reading the code carefully you’ll probably spot a little bit of code I haven’t described. <code>register_callback</code> is there to support event proxies – we’ll talk about the details when we get to <a href="http://techartsurvival.blogspot.com/2014/04/the-main-event-event-oriented.html">event proxies</a> in the future.  </p>
<p>Despite my rather verbose way of describing it all, this is not a lot of code. Which is what exactly you want in a base class: simple, common functionality, not rocket science. Hopefully, though, adding those pythonic behaviors will save a lot of waste verbiage in production work.  </p>
<p><img alt="" src="http://3.bp.blogspot.com/-9goyxbxMoA8/Uy5eUMQ1DxI/AAAAAAABIBI/McpZ1Vp2SIQ/s1600/yeoldeayb+(2" />  </p>
<blockquote>
<p>Damn, the internet has a lot of time on its hands   </p>
</blockquote>
<h2>All Your Children Are Belong To Parent Layout</h2>
<p>There’s one little bit of plumbing in Control that is worth calling out:  </p>
<div class="highlight"><pre><span></span><span class="n">Layout</span><span class="o">.</span><span class="n">add_current</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>


<p>That’s way of making sure that we can store references to our control wrappers in our layout wrappers - that is, when you create a wrapped button inside a wrapped columnLayout, the columnLayout has a handle to the wrapper class for the button. Which brings us around neatly to the wrapper class for layouts - called… wait for it… Layout.  </p>
<p>To support nesting, we want our Layout wrapper class to be a context manager. The idea is that you when you start a Layout, it declares itself the active layer and all GUI controls that get created add themselves to it; when you’re done with it control is return to whatever Layout was active before. As Doctor Who says of bow ties, “Context Managers are cool.”  </p>
<p>If you’ve done a lot of Maya GUI you know it’s also nice to have the same functionality for menus as well. So, to avoid repeating ourselves let’s start by creating a generic version of Control that works as a context manager so we can get identical functionality in windows, layouts and menus. Then we can inherit it into a wrapper class for layouts and another for windows and voila, they are all context managers without cutting and pasting. Here’s the abstract base class for all ‘nested’ classes: menus, windows, layouts etc:  </p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Nested</span><span class="p">(</span><span class="n">Control</span><span class="p">):</span>  
    <span class="sd">&#39;&#39;&#39;  </span>
<span class="sd">    Base class for all the nested context-manager classes which automatically parent themselves  </span>
<span class="sd">    &#39;&#39;&#39;</span>  
    <span class="n">ACTIVE_LAYOUT</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">Controls</span> <span class="o">=</span> <span class="p">[]</span>  
        <span class="nb">super</span><span class="p">(</span><span class="n">Nested</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">__cache_layout</span> <span class="o">=</span> <span class="n">Nested</span><span class="o">.</span><span class="n">ACTIVE_LAYOUT</span>  
        <span class="n">Nested</span><span class="o">.</span><span class="n">ACTIVE_LAYOUT</span> <span class="o">=</span> <span class="bp">self</span>  
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span>  
        <span class="n">Nested</span><span class="o">.</span><span class="n">ACTIVE_LAYOUT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cache_layout</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">__cache_layout</span> <span class="o">=</span> <span class="bp">None</span>  
        <span class="n">cmds</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">layout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
        <span class="sd">&#39;&#39;&#39;  </span>
<span class="sd">        this is called at the end of a context, it can be used to (for example) perform attachments  </span>
<span class="sd">        in a formLayout.  Override in derived classes for different behaviors.  </span>
<span class="sd">        &#39;&#39;&#39;</span>  
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Controls</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control</span><span class="p">):</span>  
        <span class="n">path_difference</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">Widget</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Widget</span><span class="p">):]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>  
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path_difference</span><span class="p">:</span>  
            <span class="bp">self</span><span class="o">.</span><span class="n">Controls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">control</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">control</span><span class="o">.</span><span class="n">Key</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">control</span><span class="o">.</span><span class="n">Key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>  
            <span class="k">if</span> <span class="n">control</span><span class="o">.</span><span class="n">Key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>  
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Children of a layout must have unique IDs&#39;</span><span class="p">)</span>  
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">control</span><span class="o">.</span><span class="n">Key</span><span class="p">]</span> <span class="o">=</span> <span class="n">control</span>

    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control</span><span class="p">):</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">Controls</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">control</span><span class="p">)</span>  
        <span class="n">k</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="n">control</span><span class="p">]</span>  
        <span class="k">if</span> <span class="n">k</span><span class="p">:</span>  
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Controls</span><span class="p">:</span>  
            <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>  
                <span class="k">yield</span> <span class="n">sub</span>  
        <span class="k">yield</span> <span class="bp">self</span>

    <span class="nd">@classmethod</span>  
    <span class="k">def</span> <span class="nf">add_current</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">control</span><span class="p">):</span>  
        <span class="k">if</span> <span class="n">cls</span><span class="o">.</span><span class="n">ACTIVE_LAYOUT</span><span class="p">:</span>  
            <span class="n">Nested</span><span class="o">.</span><span class="n">ACTIVE_LAYOUT</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">control</span><span class="p">)</span>
</pre></div>


<p>All that really does is pop the current <code>Nested</code> onto a stack and make it possible for other controls to add themselves to the instance on top of the stack.  </p>
<p>Here’s the concrete implementation for actual Layout classes:  </p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Layout</span><span class="p">(</span><span class="n">Nested</span><span class="p">):</span>

    <span class="n">CMD</span> <span class="o">=</span> <span class="n">cmds</span><span class="o">.</span><span class="n">layout</span>  
    <span class="n">_ATTRIBS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;annotation&#39;</span><span class="p">,</span> <span class="s1">&#39;backgroundColor&#39;</span><span class="p">,</span> <span class="s1">&#39;defineTemplate&#39;</span><span class="p">,</span> <span class="s1">&#39;docTag&#39;</span><span class="p">,</span> <span class="s1">&#39;dragCallback&#39;</span><span class="p">,</span> <span class="s1">&#39;dropCallback&#39;</span><span class="p">,</span> <span class="s1">&#39;enable&#39;</span><span class="p">,</span> <span class="s1">&#39;enableBackground&#39;</span><span class="p">,</span> <span class="s1">&#39;exists&#39;</span><span class="p">,</span> <span class="s1">&#39;fullPathName&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="s1">&#39;manage&#39;</span><span class="p">,</span> <span class="s1">&#39;noBackground&#39;</span><span class="p">,</span> <span class="s1">&#39;numberOfPopupMenus&#39;</span><span class="p">,</span> <span class="s1">&#39;parent&#39;</span><span class="p">,</span> <span class="s1">&#39;popupMenuArray&#39;</span><span class="p">,</span> <span class="s1">&#39;preventOverride&#39;</span><span class="p">,</span> <span class="s1">&#39;useTemplate&#39;</span><span class="p">,</span> <span class="s1">&#39;visible&#39;</span><span class="p">,</span> <span class="s1">&#39;visibleChangeCommand&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">]</span>  
    <span class="n">_CALLBACKS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dragCallback&#39;</span><span class="p">,</span> <span class="s1">&#39;dropCallback&#39;</span><span class="p">,</span> <span class="s1">&#39;visibleChangeCommand&#39;</span><span class="p">]</span>  
    <span class="n">_READ_ONLY</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;isObscured&#39;</span><span class="p">,</span> <span class="s1">&#39;popupMenuArray&#39;</span><span class="p">,</span> <span class="s1">&#39;numberOfPopupMenus&#39;</span><span class="p">,</span> <span class="s1">&#39;childArray&#39;</span><span class="p">,</span> <span class="s1">&#39;numberOfChildren&#39;</span><span class="p">]</span>
</pre></div>


<p>This is just a regular mGUI class (it gets all of the metaclass behavior from <code>Control</code>, via <code>Nested</code>) with added properties for common layout properties like <code>numberOfChildren</code>.  </p>
<p>While we’re messing with contexts, this is also a great opportunity to do what PyMel already does and make all layouts automatically manage UI parenting. This gets rid of all those irritating calls to setParent(“..”), and lets us write GUI code that looks like real Python and not a plate of spaghetti. Compare this wordy cmds example:  </p>
<div class="highlight"><pre><span></span><span class="n">win</span> <span class="o">=</span> <span class="n">window</span><span class="p">(</span><span class="s1">&#39;main window&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Ugly version&quot;</span><span class="p">)</span>  
<span class="n">columnLayout</span><span class="p">(</span><span class="s1">&#39;GUI&#39;</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">256</span><span class="p">)</span>  
<span class="n">frameLayout</span><span class="p">(</span><span class="s2">&quot;t_buttons&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;buttons column&quot;</span><span class="p">)</span>  
<span class="n">columnLayout</span><span class="p">(</span><span class="s2">&quot;col&quot;</span><span class="p">)</span>  
<span class="n">sphere_1</span> <span class="o">=</span> <span class="n">button</span><span class="p">(</span><span class="s1">&#39;mkSphere&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Make Sphere&quot;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">make_sphere</span><span class="p">)</span>  
<span class="n">cone_1</span> <span class="o">=</span> <span class="n">button</span><span class="p">(</span><span class="s1">&#39;mkCone&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span><span class="s2">&quot;Make Cone&quot;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">make_cone</span><span class="p">)</span>  
<span class="n">cube_1</span> <span class="o">=</span> <span class="n">button</span><span class="p">(</span><span class="s1">&#39;mkCube&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span><span class="s2">&quot;Make Cube&quot;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">make_cube</span><span class="p">)</span>  
<span class="n">setParen</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">)</span>  
<span class="n">setParent</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">)</span>  
<span class="n">frameLayout</span><span class="p">(</span><span class="s2">&quot;r_buttons&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;buttons row&quot;</span><span class="p">)</span>  
<span class="n">rowLayout</span> <span class="p">(</span><span class="s2">&quot;row&quot;</span><span class="p">,</span> <span class="n">numberOfColumns</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  
<span class="n">sphere_2</span> <span class="o">=</span> <span class="n">button</span><span class="p">(</span><span class="s1">&#39;mkSphere&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Make Sphere&quot;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">make_sphere</span><span class="p">)</span>  
<span class="n">cone_2</span> <span class="o">=</span> <span class="n">button</span><span class="p">(</span><span class="s1">&#39;mkCone&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span><span class="s2">&quot;Make Cone&quot;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">make_cone</span><span class="p">)</span>  
<span class="n">cube_2</span> <span class="o">=</span> <span class="n">utton</span><span class="p">(</span><span class="s1">&#39;mkCube&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span><span class="s2">&quot;Make Cube&quot;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">make_cube</span><span class="p">)</span>  
<span class="n">setParen</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">)</span>  
<span class="n">setParent</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">)</span>  
<span class="n">frameLayout</span><span class="p">(</span><span class="s2">&quot;g_buttons&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;buttons grid&quot;</span><span class="p">)</span>  
<span class="n">gridLayout</span><span class="p">(</span><span class="s2">&quot;grid&quot;</span><span class="p">,</span> <span class="n">numberOfColumns</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>  
<span class="n">sphere_3</span> <span class="o">=</span> <span class="n">button</span><span class="p">(</span><span class="s1">&#39;mkSphere&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Make Sphere&quot;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">make_sphere</span> <span class="p">)</span>  
<span class="n">cone_3</span> <span class="o">=</span> <span class="n">button</span><span class="p">(</span><span class="s1">&#39;mkCone&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span><span class="s2">&quot;Make Cone&quot;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">make_cone</span><span class="p">)</span>  
<span class="n">cube_3</span> <span class="o">=</span> <span class="n">button</span><span class="p">(</span><span class="s1">&#39;mkCube&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span><span class="s2">&quot;Make Cube&quot;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">make_cube</span><span class="p">)</span>  
<span class="n">circle_btn</span> <span class="o">=</span> <span class="n">button</span><span class="p">(</span><span class="s1">&#39;mkCircle&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Make Circle&quot;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">make_circle</span><span class="p">)</span>  
<span class="n">setParen</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">)</span>  
<span class="n">setParent</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">)</span>  
<span class="n">setParent</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">)</span>  
<span class="n">showWindow</span><span class="p">(</span><span class="n">win</span><span class="p">)</span>
</pre></div>


<p>To this version using context manager layouts:  </p>
<blockquote>
<p><strong>Historical note:</strong> This uses 'mGui 1' syntax; in mGui 2 the explicit keys would not be needed</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mGUI.GUI</span> <span class="kn">import</span> <span class="o">*</span>  
<span class="c1"># note the caps: all of these are wrapper objects, not Maya.cmds!</span>

<span class="n">window</span> <span class="o">=</span> <span class="n">Window</span><span class="p">(</span><span class="s1">&#39;main window&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;How&#39;s this&quot;</span><span class="p">)</span>    
<span class="k">with</span> <span class="n">ColumnLayout</span><span class="p">(</span><span class="s1">&#39;GUI&#39;</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">256</span><span class="p">)</span> <span class="k">as</span> <span class="n">GUI</span><span class="p">:</span>  
    <span class="k">with</span> <span class="n">FrameLayout</span><span class="p">(</span><span class="s2">&quot;t_buttons&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;buttons column&quot;</span><span class="p">):</span>  
        <span class="k">with</span> <span class="n">ColumnLayout</span><span class="p">(</span><span class="s2">&quot;col&quot;</span><span class="p">):</span>  
            <span class="n">Button</span><span class="p">(</span><span class="s1">&#39;mkSphere&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Make Sphere&quot;</span><span class="p">)</span>  
            <span class="n">Button</span><span class="p">(</span><span class="s1">&#39;mkCone&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span><span class="s2">&quot;Make Cone&quot;</span><span class="p">)</span>  
            <span class="n">Button</span><span class="p">(</span><span class="s1">&#39;mkCube&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span><span class="s2">&quot;Make Cube&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">FrameLayout</span><span class="p">(</span><span class="s2">&quot;r_buttons&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;buttons row&quot;</span><span class="p">):</span>  
        <span class="k">with</span> <span class="n">RowLayout</span> <span class="p">(</span><span class="s2">&quot;row&quot;</span><span class="p">,</span> <span class="n">numberOfColumns</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>  
            <span class="n">Button</span><span class="p">(</span><span class="s1">&#39;mkSphere&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Make Sphere&quot;</span><span class="p">)</span>  
            <span class="n">Button</span><span class="p">(</span><span class="s1">&#39;mkCone&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span><span class="s2">&quot;Make Cone&quot;</span><span class="p">)</span>  
            <span class="n">Button</span><span class="p">(</span><span class="s1">&#39;mkCube&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span><span class="s2">&quot;Make Cube&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">FrameLayout</span><span class="p">(</span><span class="s2">&quot;g_buttons&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;buttons grid&quot;</span><span class="p">):</span>  
        <span class="k">with</span> <span class="n">GridLayout</span><span class="p">(</span><span class="s2">&quot;grid&quot;</span><span class="p">,</span> <span class="n">numberOfColumns</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>  
            <span class="n">Button</span><span class="p">(</span><span class="s1">&#39;mkSphere&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Make Sphere&quot;</span><span class="p">)</span>  
            <span class="n">Button</span><span class="p">(</span><span class="s1">&#39;mkCone&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span><span class="s2">&quot;Make Cone&quot;</span><span class="p">)</span>  
            <span class="n">Button</span><span class="p">(</span><span class="s1">&#39;mkCube&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span><span class="s2">&quot;Make Cube&quot;</span><span class="p">)</span>  
            <span class="n">Button</span><span class="p">(</span><span class="s1">&#39;mkCircle&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Make Circle&quot;</span><span class="p">)</span>
</pre></div>


<p>That example also includes one other neat way to leverage contexts too. If you double check the <code>add</code> method in <code>Nested</code> you’ll see that it adds child wrapper objects to it’s own <code>__dict__</code>. That makes them accessible without having to explicitly store them. In this example, you could get to the last sphere-making button in this example as <code>GUI.g_buttons.grid.mk_sphere</code> without having to manually capture the name of the underlying widgets they way the first example must. Since Maya GUI is always a single-rooted hierarchy, as long as you know the first parent of a window or panel you can always get to any of its the child layouts or controls. This saves a lot of the boring boilerplate you would otherwise need to do just keeping track of bits and pieces.  </p>
<p>There’s one little extra bit of magic in there to let the add method discriminate between children you care about and those you don’t. If your child controls have no key set, they won’t be added to the <code>__dict__</code>. On a related note, you can also be tricksy and add a control which is not a direct child of the layout - for example, if you had a layout with a list of widgets in a scrollLayout, you don’t usually don’t care about the scrollbar - it’s just along for the ride. So you can add the widgets directly to the ‘real’ parent layout and keep the paths nice and trim. The goal, after all, is to make the GUI layout a logical tree you can work with efficiently. There’s a practical example of this trick in the <a href="https://github.com/theodox/mGUI/blob/master/mGUI/lists.py">lists.py</a> file on Github.</p>
<p>Here’s a snippet tacked on to the end of that last sample showing how you can use the iterability of the layouts to set properties in bulk. You can see how the work of turning command-style access into property style access, combined with the extra clarity we get from context managers, really pays off:  </p>
<div class="highlight"><pre><span></span><span class="c1"># using the iterability of the layout to set widths</span>

<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">GUI</span><span class="o">.</span><span class="n">t_buttons</span><span class="p">:</span>  
    <span class="n">item</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">256</span>

<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">GUI</span><span class="o">.</span><span class="n">r_buttons</span><span class="o">.</span><span class="n">row</span><span class="p">:</span>  
    <span class="n">item</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">85</span>  
<span class="n">item</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">256</span>  <span class="c1"># the last item is GUI.r_buttons.row itself  </span>
<span class="n">item</span><span class="o">.</span><span class="n">columnWidth3</span> <span class="o">=</span> <span class="p">(</span><span class="mi">85</span><span class="p">,</span><span class="mi">85</span><span class="p">,</span><span class="mi">85</span><span class="p">)</span>  <span class="c1"># ditto</span>

<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">GUI</span><span class="o">.</span><span class="n">g_buttons</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>  
    <span class="n">item</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">128</span>  
<span class="n">item</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">256</span>  <span class="c1"># now the last item is the grid  </span>
<span class="n">item</span><span class="o">.</span><span class="n">cellWidth</span> <span class="o">=</span> <span class="mi">128</span>

<span class="n">cmds</span><span class="o">.</span><span class="n">showWindow</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
</pre></div>


<p><img alt="" src="http://1.bp.blogspot.com/-YbhMcGSYTpg/Uy58bLV2nlI/AAAAAAABIBo/4q3TtCRPosI/s1600/example.png" />  </p>
<p>I don’t even want to think about the equivalent code in <code>cmds</code>!<br />
One parting note about the naming scheme, It does have one, inevitable drawback: it means that the child wrappers have unique names inside a given context. Not much we can do about that. They can, however, have the same name under different parents - the example above has , <code>GUI.t_buttons.grid</code>.<code>mk_sphere</code>, and <code>GUI.g_buttons.grid.mk_sphere</code> Thats a useful thing to exploit if you want to, say, find all of the ‘Select’ buttons on a form and disable them or something off that sort.  </p>
<h2>Make All Zig!</h2>
<p>Hopefully, the combination of some syntax sugar in our wrappers and turning layouts into context managers will make Maya GUI layout less of a pain in the butt. However, we still need to actually crank out all the wrappers for all those scores of classes in the Maya GUI library. Descriptors and metaclasses are powerful tools, but few of us have the intestinal fortitude to plow through the dozens of classes in the Maya GUI library getting every flag and command correct.  </p>
<p>In an ideal world we’d have a way of reflecting over some kind of assembly information and extracting all of the Maya GUI commands with their flags and options. Of course, in an ideal world we would not have to do this in the first place, since the native GUI system would not be the unfortunate SNES-era mishmash that it is.  </p>
<p><img alt="" src="http://games.shizzle.be/wp-content/images/060419-all-your-base-are-belong-to-us.jpg" />  </p>
<blockquote>
<p>Mass production is a pain in the ass.  </p>
</blockquote>
<p>Luckily, the TA spirit cannot be kept down by adversity. In this case we don’t have a nice clean api but we do have MEL.... poor, neglected, wallflower MEL. Well, here’s a chance for the wallflower to save the party: MEL’s help command can list all of the commands and all of the flags in Maya. So, what we need to do is to run through all of the Mel commands in help, find the ones that look like GUI commands, and capture their command - flag combinations as raw material for our metaclass control factory.  </p>
<p>See? This was getting all programmery, but now we’re back in familiar TA spit-and-bailing-wire territory. Comfier?  </p>
<p>The actual code to build the wrappers isn’t particularly interesting (its <a href="https://github.com/theodox/mGUI/blob/master/mGUI/helpers/tools.py">here</a> if you want to see it). In two sentences: Use the mel <code>help *</code> command to find all of the commands in Maya which share flags with cmds.control or cmds.layout. Then collect their flags to make the list of class attributes that the metaclass uses to create property descriptors. The final output will be a big ol’ string of class definitions like this:  </p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FloatSlider</span><span class="p">(</span><span class="n">Control</span><span class="p">):</span>  
    <span class="sd">&#39;&#39;&#39;sample output from mGUI.helpers.tools.generate_commands()&#39;&#39;&#39;</span>  
    <span class="n">CMD</span> <span class="o">=</span> <span class="n">cmds</span><span class="o">.</span><span class="n">floatSlider</span>  
    <span class="n">_ATTRIBS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="s1">&#39;maxValue&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;minValue&#39;</span><span class="p">]</span>  
    <span class="n">_CALLBACKS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;changeCommand&#39;</span><span class="p">,</span><span class="s1">&#39;dragCommand&#39;</span><span class="p">]</span>
</pre></div>


<p>We generate two files, one for controls and one for layouts (that’s an arbitrary design call on my part, you could of course have one file). Now they’re just sitting on disk as if we’d written them by hand. We can import our newly generated modules and away we go, with nice pythonic properties and our new functions.  </p>
<p>There is one judgement call here that is worth mentioning in passing.<br />
The logic in the helper modules which generate this is all deterministic, it doesn’t need human intervention so it could actually be run at module load time rather than being run and dumped out to a file. For what I want to do, I felt that physical files were a better choice, because they allow the option of hand tailoring the wrapper classes as the project evolves. Plus, the startup cost of trolling through every MEL command, while it’s not very big, is real and it seems good to avoid it. I’ve have heard enough grumbling over the years about PyMel’s startup speed that I thought it wisest to opt for speed and clarity over fewer files on disk.  </p>
<p>One nice side effect of generating our wrappers this way: we’ve added some functionality through our base classes but fundamentally we’ve kept the same names and options we already know from plain old Maya.cmds. The only changes are the mandatory names and the fact that I’ve capitalized the class names to make them more pep-8-friendly.  </p>
<p>Hopefully, keeps the learning curve short for new user. Its hard enough to pick up a new style, making you memorize hundreds of new property names seem like a big tax on users.  </p>
<p>In the version up on Github (and in this example) I opted to use only the long name for the properties. This is definitely a matter of taste; I’m sure that many TAs out there are sufficiently familiar with the old Maya command flags that a howler like <code>cmds.rowLayout(nc=2, cw2=(50,100), ct2=('both', 5), bgc = (.8,.6,.6), cl2=("left", "right")</code> makes its meaning clear. for my part, though, the long names clarify the intent of the code enormously if you make a fairly small upfront investment in typing.   </p>
<p>If you are of the opposite opinion, though, you can call the <code>generate_helpers</code> and <code>generate_controls</code> functions in mGUI.helpers.tools with <code>includeShortNames</code> set to true make your own wrappers with the short flags too.  </p>
<h2>What You Say!!!</h2>
<p>Now we’ve got a complete library of all the widgets. You can see the results in <a href="https://github.com/theodox/mGUI/blob/master/mGUI/core/controls.py">controls.py</a> and <a href="https://github.com/theodox/mGUI/blob/master/mGUI/core/layouts.py">layouts.py</a> on GitHub. (The base classes are also up there for your perusal in <a href="https://github.com/theodox/mGUI/blob/master/mGUI/core/__init__.py">the root of the core module</a>). If all you want is to stop writing long commands every time you touch a GUI item, you’re done. You can write crisper layout code, tweak your properties, and so on with what we’ve covered so far. If you’re interested in making practical use of this setup – remember that WIP warning! – you should read the docs in the events.py module to make sure you know how to hook up callback events. I’ll cover that in more detail in the future.<br />
However… Simpler syntax is just scratching the surface of what we can get up to now that we have a proper class library for our widgets. Next time out we’ll look at the event mechanism in more detail and talk about how to cleanly separate your functional code, GUI layouts, and the display styles of your widgets.  </p>
<p><a href="http://www.youtube.com/watch?v=8fvTxv46ano">Until next time....</a></p>
    </article>

        <div class="tags">
            <p>tags: <a href="../tag/maya.html">Maya</a>, <a href="../tag/python.html">python</a>, <a href="../tag/gui.html">GUI</a>, <a href="../tag/programming.html">programming</a></p>
        </div>

<hr>
<div class="sharing">
</div>
    <hr>

        <div class="comments">
            <h2>Comments !</h2>
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'theodoxcom';
                var disqus_identifier = '2014/all_your_base';
                var disqus_url = '../2014/all_your_base';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//theodoxcom.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
            </div>
            <!---- right sidebar -->
            <div class="col-lg-2 col-md-1">
                <div class="vertical-spacer">
                <h4>@social</h4>
                    <ul class="list-inline text-center">
                            <li>
                                <a href="https://www.linkedin.com/in/stevetheodore">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/theodox">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://plus.google.com/u/0/+SteveTheodore480BC/posts">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-google fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="http://stackoverflow.com/users/1936075/theodox">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-stack-overflow fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
                
                </div>
                <div class="vertical-spacer">
                <h4>#tags</h4>
                    <a href="/tags">tag list</a>
                    
                        <a class="tag-link" href="../tag/animation.html">animation</a>
                        <a class="tag-link" href="../tag/api.html">api</a>
                        <a class="tag-link" href="../tag/articles.html">articles</a>
                        <a class="tag-link" href="../tag/blog.html">blog</a>
                        <a class="tag-link" href="../tag/blogging.html">blogging</a>
                        <a class="tag-link" href="../tag/boo.html">boo</a>
                        <a class="tag-link" href="../tag/books.html">books</a>
                        <a class="tag-link" href="../tag/bugs.html">bugs</a>
                        <a class="tag-link" href="../tag/careers.html">careers</a>
                        <a class="tag-link" href="../tag/cg.html">cg</a>
                        <a class="tag-link" href="../tag/console.html">console</a>
                        <a class="tag-link" href="../tag/distribution.html">distribution</a>
                        <a class="tag-link" href="../tag/games.html">games</a>
                        <a class="tag-link" href="../tag/gdc.html">gdc</a>
                        <a class="tag-link" href="../tag/graphics.html">graphics</a>
                        <a class="tag-link" href="../tag/gui.html">GUI</a>
                        <a class="tag-link" href="../tag/industry.html">industry</a>
                        <a class="tag-link" href="../tag/ls.html">ls</a>
                        <a class="tag-link" href="../tag/markdown.html">markdown</a>
                        <a class="tag-link" href="../tag/math.html">math</a>
                        <a class="tag-link" href="../tag/maya.html">maya</a>
                        <a class="tag-link" href="../tag/mgui.html">mGui</a>
                        <a class="tag-link" href="../tag/minq.html">minq</a>
                        <a class="tag-link" href="../tag/modeling.html">modeling</a>
                        <a class="tag-link" href="../tag/modelling.html">modelling</a>
                        <a class="tag-link" href="../tag/modo.html">modo</a>
                        <a class="tag-link" href="../tag/modules.html">modules</a>
                        <a class="tag-link" href="../tag/moonrise.html">moonrise</a>
                        <a class="tag-link" href="../tag/photoshop.html">photoshop</a>
                        <a class="tag-link" href="../tag/pipeline.html">pipeline</a>
                        <a class="tag-link" href="../tag/programming.html">programming</a>
                        <a class="tag-link" href="../tag/python.html">python</a>
                        <a class="tag-link" href="../tag/regex.html">regex</a>
                        <a class="tag-link" href="../tag/sfx.html">sfx</a>
                        <a class="tag-link" href="../tag/shaders.html">shaders</a>
                        <a class="tag-link" href="../tag/siggraph.html">siggraph</a>
                        <a class="tag-link" href="../tag/sod.html">SOD</a>
                        <a class="tag-link" href="../tag/spelcheck.html">spelcheck</a>
                        <a class="tag-link" href="../tag/standalone.html">standalone</a>
                        <a class="tag-link" href="../tag/techart.html">techart</a>
                        <a class="tag-link" href="../tag/thunderbirds.html">thunderbirds</a>
                        <a class="tag-link" href="../tag/tools.html">tools</a>
                        <a class="tag-link" href="../tag/unity.html">unity</a>
                        <a class="tag-link" href="../tag/web.html">web</a>
                        <a class="tag-link" href="../tag/writing.html">writing</a>
                </div>
                 <div class="vertical-spacer">
                <h4>archives</h4>
                    <a href="/archives">site history</a>
                </div> 
                <div class="vertical-spacer">
                <h4>feeds </h4>
                <p class="feed-button"><a href="/feeds/atom.xml">Atom</a></p>
                <p class="feed-button"><a href="/feeds/rss.xml">Rss</a>&nbsp;</p>
                </div>   

            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

<p class="copyright text-muted">
   	Site contents &copy; Steve Theodore.  Blog powered by <a href="http://getpelican.com">Pelican</a> and <a href="http://python.org">Python</a>.
</p>                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="../theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="../theme/js/bootstrap.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="../theme/js/clean-blog.min.js"></script>

<script type="text/javascript">
    var disqus_shortname = 'theodoxcom';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>

</html>