<!DOCTYPE html>
<html lang="en">
<head>
          <title>Chimeras & Manticores</title>
        <meta charset="utf-8" />
        <link href="http://theodox.com/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Chimeras & Manticores Full Atom Feed" />
        <link href="http://theodox.com/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="Chimeras & Manticores Full RSS Feed" />



    <meta name="tags" content="Maya" />
    <meta name="tags" content="python" />
    <meta name="tags" content="modules" />
    <meta name="tags" content="programming" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://theodox.com/">Chimeras & Manticores <strong>technical art, python, the games business, and obscurantism</strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
            <li><a href="/about">About...</a></li>
            <li><a href="/pages/pub">Publications</a></li>
            <li><a href="http://astore.amazon.com/tecsurgui-20">Tech-Art Book Store</a></li>
            <li><a href="/pages/cookbook">Cookbook</a></li>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="http://theodox.com/2014/magical_modules" rel="bookmark"
         title="Permalink to Maya’s (mildy) Magical Modules">Maya&#8217;s (mildy) Magical&nbsp;Modules</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2014-01-12T17:45:00-08:00">
      Sun 12 January 2014
    </abbr>
    <address class="vcard author">
      By           <a class="url fn" href="http://theodox.com/author/steve-theodore.html">Steve Theodore</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>If you&#8217;re doing tools work in Maya, you&#8217;ve probably seen a lot of ways of distributing scripts and tools. The most common, alas, is also the wonkiest - dumping a bunch of scripts into the users&#8217;s script folder or maybe fiddling with Maya.env to point at a shared drive on the local&nbsp;network.     </p>
<p>Eventually, you&#8217;ll rum into situations where you can&#8217;t just litter files all over your user&#8217;s machine. Maybe you&#8217;re supporting multiple projects in the studio and you need to have users hopping back and forth between toolsets. Maybe you&#8217;re dealing with multiple versions of Maya and your tools have been forked into different environments. Maybe you&#8217;re dealing with outsources who don&#8217;t want to permanently alter their own environment just to get your tools for one project. Whatever the reason, someday you&#8217;ll run into a situation where you want to be able to drop in a whole Maya toolset as a unit and to remove or disable it the same&nbsp;way.   </p>
<p>Maya has always a had a facility called <strong>modules</strong>, can be useful for this purpose. It used to be used for things like  cloth sim or hair that were tacked on to the main package (back when hair was a $9,000 add-on!) .  Since then it&#8217;s largely fallen out of favor, but it&#8217;s never gone away &#8212; and it has some useful properties that are great for tools&nbsp;distribution.  </p>
<p>A module is really a sort of virtual file system.  Maya&#8217;s most important folders are those for scripts, plugins, icons, and presets &#8212; the same ones you typically see in your Maya user directory.  If you place a special text file in your module path, you can add to extra paths for Maya to search for scripts, plugins, icons and&nbsp;presets.   </p>
<p>The big advantage of modules is the ability to manage complete set of files at once - scripts, plugins and so on can all be included (or excluded) from your Maya in a single place <em>Note to Autodesk - it would be very nice to give users a <span class="caps">UI</span> for this.  The &#8216;Modules&#8217; setting in the preferences, confusingly, does not refer to _these _modules!</em>  Parts of a module can be kept independent of the user&#8217;s private stock of scripts and tools. For outsourcers and contractors, in particular, the ability to completely uninstall a toolset you don&#8217;t need anymore is a&nbsp;godsend.   </p>
<p>Another handy feature of modules is that they can point Maya at shared network paths as well as paths on disk. This makes it far easier to keep a whole team on a common tool set by pointing a module script directory at a shared drive.  I&#8217;m not personally a big fan of the shared drive as a distribution method (more on that some other time) but it&#8217;s fairly common and this makes it easy to establish and&nbsp;manage.  </p>
<p>Finally modules do a little bit of automatic versioning. A module can specify different paths for different Maya versions, <span class="caps">OS</span>&#8217;es and processors.  This means a tool author can produce a single distribution for all customers and give them identical installation instructions without worrying too much about the details of the individual workstations on the receiving end.  You can pack up all of your distributions into a single zip file, and users merely unzip it into the modules folder of their local settings and the installation is done&nbsp;.  </p>
<h3>Basic&nbsp;Setup</h3>
<p>Modules are defined by a simple text file with a &#8220;.mod&#8221; extension.  Maya will look for module files in all the directories in the Maya_MODULE_PATH environment variable if you have it set, or in the modules directory of your Maya user directory (for example, in My Documents\Maya\modules). Here are the default locations where modules can be&nbsp;placed:  </p>
<h4>Default for&nbsp;Windows</h4>
<div class="highlight"><pre><span></span>&lt;user&gt;/My Documents/Maya/modules  
C:/Program Files/Common Files/Autodesk Shared/Modules/Maya/  
C:/Program Files/Common Files/Autodesk Shared/Modules/Maya/modules/
</pre></div>


<h4>Default for Mac <span class="caps">OS</span> X,&nbsp;Linux</h4>
<div class="highlight"><pre><span></span><span class="p">$</span><span class="nv">Maya_APP_DIR</span><span class="x">/Maya//modules  </span>
<span class="p">$</span><span class="nv">Maya_APP_DIR</span><span class="x">/Maya/modules  </span>
<span class="x">/usr/autodesk/modules/Maya/  </span>
<span class="x">/usr</span>
</pre></div>


<p>A module file is a plain text file. The official documentation for the format is <a href="http://docs.autodesk.com/MayaUL/2013/ENU/Maya-API-Documentation/index.html?url=files/GUID-9E096E39-AD0D-4E40-9B2A-9127A2CAD54B.htm,topicNumber=d30e30995">here</a> <em>(the 2012 version is <a href="http://download.autodesk.com/global/docs/Mayasdk2012/en_us/index.html">here</a>.  There are some pretty significant differences between 2012 and 2013+)!</em>.</p>
<p>For the simple case a module file just looks like&nbsp;this:</p>
<div class="highlight"><pre><span></span>+ moduleName 1.0 c:\path\to\moduleName
</pre></div>


<p>The module name is what shows up in the Maya <span class="caps">UI</span>, the 1.0 is a version number, and the path points Maya to the location of the module folder.  This example would point to a folder called &#8220;ModuleName&#8221;. If that&#8217;s all that goes in there, then Maya will look for scripts&nbsp;in  </p>
<div class="highlight"><pre><span></span>c:\path\to\moduleName\scripts
</pre></div>


<p>icons&nbsp;in  </p>
<div class="highlight"><pre><span></span>c:\path\to\moduleName\icons
</pre></div>


<p>and plugins&nbsp;in  </p>
<div class="highlight"><pre><span></span>c:\path\to\moduleName\plug-ins
</pre></div>


<p>You can test this out by making the folder <code>c:\path\to\moduleName\scripts</code> and popping a <code>userSetup.py</code> ( or a <code>userSetup.mel</code>, if you&#8217;re feeling old school) into it containing something like a <code>print("hello world")</code>. When you restart your Maya, you should see it printout in the Maya output window as Maya loads. It&#8217;s the output window for Python because the script will execute <em>before</em> the Maya <span class="caps">UI</span> has loaded (something to keep in mind in your startup&nbsp;scripts!).  </p>
<p>You can avoid hard coding the paths by using an alternate syntax in the mode file.  You have a can, for example, include an environment variable using <code>${variable}</code> in place of an absolute path. For&nbsp;example  </p>
<div class="highlight"><pre><span></span>+ moduleName 1.0 <span class="cp">${</span><span class="n">PROJECT_LOC</span><span class="cp">}</span>\Mayatools
</pre></div>


<p>will point look for your module folder in the location defined by the environment variable named <strong>project_loc</strong>.  One side effect of this is that uou can put your modules into the modules folder (alongside your mod files) without having to hard-code&nbsp;paths:  </p>
<div class="highlight"><pre><span></span>+ moduleName 1.0 <span class="cp">${</span><span class="n">Maya_MODULE_PATH</span><span class="cp">}</span>\moduleName
</pre></div>


<p>You can even point your modules at a network&nbsp;share:  </p>
<div class="highlight"><pre><span></span>+ moduleName 1.0 \\net\shared\modules\moduleName
</pre></div>


<h3>Fancy stuff in&nbsp;2013+</h3>
<p>Sometimes setup requirements are more complex than dropping in a single folder (not a good idea if you can avoid it - but you know how it is&#8230;).  <strong>In 2013 and later,</strong>  you can use the module file to override particular paths and do some more flexible&nbsp;setup.  </p>
<p>For example, in 2013+, you can also define the path relative to the module file&nbsp;location:  </p>
<div class="highlight"><pre><span></span>+ moduleName 1.0 ..\moduleName
</pre></div>


<p>should point at a folder <em>above</em> the directory where the module file is located. <strong>But  remember: 2013+ only!</strong> If you&#8217;ve looked at, for example, <a href="http://around-the-corner.typepad.com/adn/2012/07/distributing-files-on-Maya-Maya-modules.html">Cyrille Fauvel&#8217;s post on modules</a> you&#8217;ll see a bunch of advice that only works for 2013+.  Be aware&nbsp;:)  </p>
<p>The other neat addition in 2013 is the ability to override specific sub-paths of the module.&nbsp;Thus  </p>
<div class="highlight"><pre><span></span>+ moduleName 1.0 <span class="cp">${</span><span class="n">Maya_MODULE_PATH</span><span class="cp">}</span>\moduleName 
scripts: //network/share/scripts
</pre></div>


<p>would point the scripts at the shared network scripts  drive, while leaving the plugins and icons folders in the module&nbsp;location.  </p>
<p>2013+ also offers the ability to set environment variables from inside a&nbsp;module  </p>
<div class="highlight"><pre><span></span>+ moduleName 1.0 <span class="cp">${</span><span class="n">Maya_MODULE_PATH</span><span class="cp">}</span>\moduleName 
HAS_FANCY_2013_FEATURES=YES
</pre></div>


<p>Will set the environment variable <code>HAS_FANCY_2013_FEATURES</code> to &#8216;yes&#8217; inside your Maya session. 2013 even has some funky syntax allowing you to append to existing variables and so on . There&#8217;s no point in recapitulating it here, the <a href="http://docs.autodesk.com/MayaUL/2013/ENU/Maya-API-Documentation/index.html?url=files/GUID-9E096E39-AD0D-4E40-9B2A-9127A2CAD54B.htm,topicNumber=d30e30995">description in the docs</a> is a concise as I could do. My only commentary would be: <em>seriously, people? It&#8217;s 2014 and still with the funky syntax crap?  I&#8217;m supposed to recognize that  _PATH += and <span class="caps">PATH</span> +:= bin _are&nbsp;different?</em>  </p>
<p>Adding to paths can be extremely handy for some things, but unfortunately this won&#8217;t solve a particularly thorny problem for tools teams, which is making sure that the <span class="caps">OS</span> can find binary dlls: if you have <span class="caps">DLL</span> dependencies in a binary plugin, its &#8216;too late&#8217; to fix it by appending the <span class="caps">DLL</span> locations to the system path once Maya has loaded. Which stinks &#8212; and is another reason to avoid binary plugins like the plague they are if at all&nbsp;possible.</p>
<h3>One stop tool distribution&#8230; or&nbsp;not</h3>
<p>For any busy <span class="caps">TA</span>, the business of distributing and maintaining toolsets on lots of other people&#8217;s computers is a constant headache.  Modules can offer some significant assistance with this, since they allow you some control over Maya&#8217;s search paths without requiring your to write code. It&#8217;s a simple solution to the chicken-and-egg problem of getting Maya to do what you want before you&#8217;ve got tools loaded up to tell Maya what to&nbsp;do.  </p>
<p>Modules, on their own, are not a complete solution to that problem.  But they are a&nbsp;help.  </p>
<p>Modules basically just tell Maya to look in a few extra places for things like scripts or plugins - they don&#8217;t automatically run startup code or do initialization, and they don&#8217;t have much in the way of smarts &#8212; they can&#8217;t for example, allow you to quickly switch between two project-specific versions of your Maya tool set. You can install modules for toolsetA and toolsetB, but something smarter than a module file has to decide which one to pick on a given occasion (I&#8217;m going to talk about that problem in another post, but for now  However they do allow you to mix and match install locations, which is a big start; they also allow you to install outside the user&#8217;s script folders, which is a key element in the good-fences-make-good-neighbors relationship between <span class="caps">TA</span> tools and the user&#8217;s private Maya preferences.  Plus, they are explicit: you can look at the file and tell what its trying to do, which beats any number of magic naming and location&nbsp;rules.  </p>
<p>At some point in the near future I&#8217;ll try to post something on the second half of the distribution puzzle: running startup code cleanly and&nbsp;intelligently.  </p>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>